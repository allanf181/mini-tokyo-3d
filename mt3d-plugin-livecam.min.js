/*!
 * mt3d-plugin-livecam v1.0.0
 * https://minitokyo3d.com
 * (c) 2022 Akihiko Kusanagi
 * Released under the MIT license
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("mini-tokyo-3d")):"function"==typeof define&&define.amd?define(["mini-tokyo-3d"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).mt3dLivecam=t(e.mt3d)}(this,(function(e){"use strict";!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css","top"===n&&o.firstChild?o.insertBefore(s,o.firstChild):o.appendChild(s),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}}(".livecam-panel {\n    height: 262px !important;\n}\n.livecam-panel.collapsed {\n    height: 50px !important;\n}\n.livecam-panel.closed {\n    height: 0 !important;\n}\n.livecam-marker {\n    width: 40px;\n    height: 40px;\n    border: 2px solid #333;\n    border-radius: 50%;\n    background: white no-repeat center/20px url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 576 512' fill='%23333'%3E%3C!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --%3E%3Cpath d='M384 112v288c0 26.51-21.49 48-48 48h-288c-26.51 0-48-21.49-48-48v-288c0-26.51 21.49-48 48-48h288C362.5 64 384 85.49 384 112zM576 127.5v256.9c0 25.5-29.17 40.39-50.39 25.79L416 334.7V177.3l109.6-75.56C546.9 87.13 576 102.1 576 127.5z'/%3E%3C/svg%3E\");\n    cursor: pointer;\n}\n.livecam-marker.active, .livecam-marker:hover {\n    border-color: #33B5E5;\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 576 512' fill='%2333B5E5'%3E%3C!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --%3E%3Cpath d='M384 112v288c0 26.51-21.49 48-48 48h-288c-26.51 0-48-21.49-48-48v-288c0-26.51 21.49-48 48-48h288C362.5 64 384 85.49 384 112zM576 127.5v256.9c0 25.5-29.17 40.39-50.39 25.79L416 334.7V177.3l109.6-75.56C546.9 87.13 576 102.1 576 127.5z'/%3E%3C/svg%3E\");\n}\n");function t(e,t){const n=t.replace("#","%23");return e.replace("%3e",` fill='${n}' stroke='${n}'%3e`)}function n(e,t,n){const o=document.createElement(e);return Object.assign(o,t),n&&n.appendChild(o),o}class o extends e.Panel{constructor(e){super(Object.assign({className:"livecam-panel"},e))}addTo(e){const{name:t,html:n}=this._options.camera;return this.setTitle(t[e.lang]).setHTML(n),super.addTo(e)}}class s{constructor(){const e=this;e.id="livecam",e.name={en:"Live Cameras",ja:"ライブカメラ",ko:"실시간 웹캠",ne:"प्रत्यक्ष क्यामेरा",th:"กล้องถ่ายทอดสด","zh-Hans":"实时摄像头","zh-Hant":"實時攝像頭"},e.iconStyle={backgroundSize:"32px",backgroundImage:`url("${t("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 576 512'%3e%3c!--! Font Awesome Free 6.0.0 by %40fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0%2c Fonts: SIL OFL 1.1%2c Code: MIT License) Copyright 2022 Fonticons%2c Inc. --%3e%3cpath d='M384 112v288c0 26.51-21.49 48-48 48h-288c-26.51 0-48-21.49-48-48v-288c0-26.51 21.49-48 48-48h288C362.5 64 384 85.49 384 112zM576 127.5v256.9c0 25.5-29.17 40.39-50.39 25.79L416 334.7V177.3l109.6-75.56C546.9 87.13 576 102.1 576 127.5z'/%3e%3c/svg%3e","white")}")`},e.clockModes=["realtime"],e.viewModes=["ground"],e.cameras={},e.markers={},e._onSelection=e._onSelection.bind(e),e._onDeselection=e._onDeselection.bind(e)}onAdd(e){this.map=e}onEnabled(){const e=this,{map:t,cameras:n}=e;t.on("selection",e._onSelection),t.on("deselection",e._onDeselection),fetch("https://mini-tokyo.appspot.com/livecam").then((e=>e.json())).then((t=>{for(const e of t)n[e.id]=e;e._addMarkers()}))}onDisabled(){const e=this,{map:t}=e;t.off("selection",e._onSelection),t.off("deselection",e._onDeselection),e.panel&&(t.trackObject(),e.panel.remove(),delete e.panel);for(const t of Object.keys(e.cameras))delete e.cameras[t];for(const t of Object.keys(e.markers))e.markers[t].remove(),delete e.markers[t]}onVisibilityChanged(e){const t=this;t.visible=e,!e&&t.panel&&t.map.trackObject();for(const n of Object.keys(t.markers))t.markers[n].setVisibility(e)}_addMarkers(){const t=this,{map:o,visible:s}=t,{lang:i}=o;for(const a of Object.keys(t.cameras)){const{center:c,zoom:r,bearing:l,pitch:m,name:d,thumbnail:p}=t.cameras[a],h=n("div",{className:"livecam-marker"}),v={id:a,selectionType:"livecam"};let f;t.markers[a]=new e.Marker({element:h}).setLngLat(c).addTo(o).setVisibility(s).on("click",(()=>{o.trackObject(v),o.getMapboxMap().flyTo({center:c,zoom:r,bearing:l,pitch:m})})).on("mouseenter",(()=>{f=(new e.Popup).setLngLat(c).setHTML(['<div class="thumbnail-image-container">','<div class="ball-pulse"><div></div><div></div><div></div></div>',`<div class="thumbnail-image" style="background-image: url('${p}');"></div>`,"</div>",`<div><strong>${d[i]}</strong></div>`].join("")).addTo(o)})).on("mouseleave",(()=>{f&&(f.remove(),f=void 0)}))}}_onSelection(e){if("livecam"===e.selectionType){const t=this,{id:n}=e;t.markers[n].setActivity(!0),t.panel=new o({camera:t.cameras[n]}).addTo(t.map)}}_onDeselection(e){if("livecam"===e.selectionType){const t=this,n=t.markers[e.id];n&&n.setActivity(!1),t.panel&&(t.panel.remove(),delete t.panel)}}}return function(){return new s}}));
//# sourceMappingURL=mt3d-plugin-livecam.min.js.map
